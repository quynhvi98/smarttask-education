<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <title>Smarttask Education</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--<meta th:name="${_csrf.parameterName}" th:value="${_csrf.token}">-->
    <!-- style sheet -->
    <link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap-3.3.7/bootstrap.min.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap-datepicker3.min.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/js/plugins/daterangepicker/daterangepicker.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/datatables.min.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/login.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/select2.min.css}"/>

    <!-- thu vien validate -->
    <link rel="stylesheet" type="text/css" th:href="@{/css/parsley.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap-datepicker.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/font-awesome.min.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/font-awesome-animation.min.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/ionicons.min.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/admin-lte.min.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/ionicons.min.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/main.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/sweetalert.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/lobibox.min.css}"/>
    <!-- css overwrite -->
    <link rel="stylesheet" type="text/css" th:href="@{/css/overwrite.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/fixgiaodienadmin.css}">
    <!-- jquery -->
    <script type="text/javascript" th:src="@{/js/jquery-3.3.1/jquery.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/bootstrap-3.3.7/bootstrap.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/jquery.slimscroll-1.3.6.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/fastclick-1.0.6.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/parsley/parsley.js}"></script>
    <!--<script type="text/javascript" th:src="@{/js/app.min.js}"></script>-->

    <!--<script type="text/javascript" th:src="@{/js/checkImage.js}"></script>-->
    <!--<script type="text/javascript" th:src="@{/js/checkImage.example.js}"></script>-->
    <script type="text/javascript" th:src="@{/js/select2/select2.full.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/bootstrap-datepicker.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/plugins/daterangepicker/moment.js}"></script>
    <script type="text/javascript" th:src="@{/js/plugins/daterangepicker/daterangepicker.js}"></script>
    <script type="text/javascript" th:src="@{/js/app.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/javascript.js}"></script>
    <script type="text/javascript" th:src="@{/js/sweetalert.js}"></script>
    <script type="text/javascript" th:src="@{/js/lobibox.js}"></script>
    <script type="text/javascript" th:src="@{/js/lobibox.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/datatables.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/datatables.config.js}"></script>
    <!--<script type="text/javascript" th:src="@{/js/cuttom.js}"></script>-->
    <script type="text/javascript" th:src="@{/js/trongtran.js}"></script>


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body class="hold-transition fixed skin-purple sidebar-mini">
<div class="wrapper">
    <div th:replace="fragments/header :: header">&nbsp;</div>
    <div class="content-wrapper">
        <!--<div layout:fragment="content">&nbsp;</div>-->
        <section class="content-header">
            <h1>
                Quản lý lớp học
            </h1>
            <ol class="breadcrumb">
                <li>
                    <a href="#">Home</a>
                </li>
                <li class="active">
                    Quản lý lớp học
                </li>
            </ol>
        </section>
        <div class="khung" data-width="5">

            <div class="input">
                <div class="label">Tên lớp học</div>
                <input type="text" value="">
            </div>
            <div class="input">
                <div class="label">Mã lớp học</div>
                <input type="text" value="">
            </div>

            <a href="#" class="submit">Tìm kiếm</a>
            <!-- <div class="submit"></div> -->
        </div>
        <h3 class="title">
            Danh sách lớp học
            <a href="#" class="add-use" data-toggle="modal" data-target="#themnhansu">
                <i class="fa fa-plus-circle" aria-hidden="true"></i>
                Thêm lớp học
            </a>
        </h3>
        <div class="table">
            <table class="tree-table">
                <thead class="fix-w text-center">
                <tr>
                    <th class="wpx-60">
                        <div>STT</div>
                    </th>
                    <th>
                        <div>Mã lớp học</div>
                    </th>
                    <th>
                        <div>Môn học</div>
                    </th>
                    <th>
                        <div>Phòng học</div>
                    </th>
                    <th>
                        <div>Giảng viên</div>
                    </th>
                    <th>
                        <div>Mô tả</div>
                    </th>
                    <th>
                        <div>Ngày bắt đầu</div>
                    </th>
                    <th>
                        <div>Ngày kết thúc</div>
                    </th>
                    <th>
                        <div>Ngày tạo</div>
                    </th>
                    <th class="wpx-40">
                        <!-- <div>Chức năng</div> -->
                    </th>
                </tr>
                </thead>
                <tbody class="text-center">
                <th:block th:if="${!#lists.isEmpty(lstLopHoc)}" th:each="lh, i : ${lstLopHoc}">
                    <tr>
                        <td th:text="${i.index+1}">1</td>
                        <td th:text="${lh.maLop}"></td>
                        <td th:text="${lh.monHoc.tenMonHoc}"></td>
                        <td th:text="${lh.phongHoc}"></td>
                        <td th:text="${lh.giaoVien.user.fullName}"></td>
                        <td th:text="${lh.moTa}"></td>
                        <td th:text="${lh.ngayBatDau}"></td>
                        <td th:text="${lh.ngayKetThuc}"></td>
                        <td th:text="${lh.ngayTao}"></td>
                        <td class="text-center">
                            <div class="dropdown bacham">
                                <a href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-right">
                                    <li class="inline">
                                        <a class="lh-detail" href="#" th:attr="itemId=${lh.maLop}" data-toggle="modal"
                                           data-target="#xemnhansu">
                                            <i class="fa fa-search" aria-hidden="true"></i> Xem
                                        </a>
                                    </li>
                                    <!--<li class="inline">-->
                                    <!--<a href="#" class="xoa"><i class="fa fa-trash-o" aria-hidden="true"></i> Xóa</a>-->
                                    <!--</li>-->
                                </ul>
                            </div>
                        </td>
                    </tr>
                </th:block>

                </tbody>
            </table>

        </div>
        </section>

        <!-- Modal themnhansu-->
        <div class="modal modal-full fade" id="themnhansu" role="dialog" aria-labelledby="themnhansuLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h3 class="modal-title" id="themnhansuLabel">
                            Thêm mới
                        </h3>
                    </div>
                    <div class="modal-body">
                        <form id="form-themmoi" class="form-horizontal">
                            <div class="">
                                <div class="row">
                                    <div class="col-md-6">

                                        <div class="form-group">
                                            <label for="" class="col-sm-3 control-label">Khoa/Viện</label>
                                            <div class="col-md-9">
                                                <select required id="khoaVien" name="khoaVien"
                                                        class="select2 form-control" title="Khoa/Viện">
                                                    <option value="">-- Chọn khoa viện --</option>
                                                    <th:block th:if="${!#lists.isEmpty(lstKhoaVien)}"
                                                              th:each="kv : ${lstKhoaVien}">
                                                        <option th:value="${kv.maVien}"
                                                                th:text="${kv.tenVien}"></option>
                                                    </th:block>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="" class="col-sm-3 control-label">Bộ môn</label>
                                            <div class="col-md-9">
                                                <select required id="boMon" name="boMon" class="select2 form-control"
                                                        title="Bộ môn">
                                                    <!--<option selected value=""><&#45;&#45;Chọn&ndash;&gt;</option>-->
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="" class="col-sm-3 control-label">Kì học</label>
                                            <div class="col-md-9">
                                                <select required id="kiHoc" name="kiHoc" class="select2 form-control"
                                                        title="Kì học">
                                                    <!--<option selected value=""><&#45;&#45;Chọn&ndash;&gt;</option>-->
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">3</option>
                                                    <option value="4">4</option>
                                                    <option value="5">5</option>
                                                    <option value="6">6</option>
                                                    <option value="7">7</option>
                                                    <option value="8">8</option>
                                                    <option value="9">9</option>
                                                    <option value="10">10</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="" class="col-sm-3 control-label">Môn học</label>
                                            <div class="col-md-9">
                                                <select required id="monHoc" name="monHoc" class="select2 form-control"
                                                        title="Bộ môn">
                                                    <!--<option selected value=""><&#45;&#45;Chọn&ndash;&gt;</option>-->
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="" class="col-sm-3 control-label">Giảng viên</label>
                                            <div class="col-md-9">
                                                <select required id="giangVien" name="giangVien"
                                                        class="select2 form-control"
                                                        title="Giảng viên">
                                                    <!--<option selected value=""><&#45;&#45;Chọn&ndash;&gt;</option>-->
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="" class="col-sm-3 control-label">Ngày học</label>

                                            <div class="col-md-7">
                                                <div class="checkbox">
                                                    <label class="col-sm-3">
                                                        Thứ 2
                                                        <input class="cbNgayHoc" value="2"
                                                               type="checkbox"/>
                                                        <input class="ngayHocHid" name="ngayHoc"
                                                               type="text" hidden/>
                                                    </label>
                                                    <label class="col-sm-3">
                                                        Ca
                                                        <select class="caHoc"
                                                                style="background-color: #DCDCDC"
                                                                disabled id="ca2" name="caHoc">
                                                            <option>1</option>
                                                            <option>2</option>
                                                            <option>3</option>
                                                            <option>4</option>
                                                            <option>5</option>
                                                            <option>6</option>
                                                        </select>
                                                    </label>
                                                    <span class="errorSub" hidden>Thời gian này đã bị trùng</span>
                                                </div>
                                                <div class="checkbox">
                                                    <label class="col-sm-3">
                                                        Thứ 3
                                                        <input class="cbNgayHoc" value="3"
                                                               type="checkbox"/>
                                                        <input class="ngayHocHid" name="ngayHoc"
                                                               type="text" hidden/>
                                                    </label>
                                                    <label class="col-sm-3">
                                                        Ca
                                                        <select class="caHoc"
                                                                style="background-color: #DCDCDC"
                                                                disabled name="caHoc">
                                                            <option>1</option>
                                                            <option>2</option>
                                                            <option>3</option>
                                                            <option>4</option>
                                                            <option>5</option>
                                                            <option>6</option>
                                                        </select>
                                                    </label>
                                                    <span class="errorSub" hidden>Thời gian này đã bị trùng</span>
                                                </div>
                                                <div class="checkbox">
                                                    <label class="col-sm-3">
                                                        Thứ 4
                                                        <input class="cbNgayHoc" value="4"
                                                               type="checkbox"/>
                                                        <input name="ngayHoc" class="ngayHocHid"
                                                               type="text" hidden/>
                                                    </label>
                                                    <label class="col-sm-3">
                                                        Ca
                                                        <select class="caHoc"
                                                                style="background-color: #DCDCDC"
                                                                disabled name="caHoc">
                                                            <option>1</option>
                                                            <option>2</option>
                                                            <option>3</option>
                                                            <option>4</option>
                                                            <option>5</option>
                                                            <option>6</option>
                                                        </select>
                                                    </label>
                                                    <span class="errorSub" hidden>Thời gian này đã bị trùng</span>
                                                </div>
                                                <div class="checkbox">
                                                    <label class="col-sm-3">
                                                        Thứ 5
                                                        <input class="cbNgayHoc" value="5"
                                                               type="checkbox"/>
                                                        <input name="ngayHoc" class="ngayHocHid"
                                                               type="text" hidden/>
                                                    </label>
                                                    <label class="col-sm-3">
                                                        Ca
                                                        <select class="caHoc"
                                                                style="background-color: #DCDCDC"
                                                                disabled name="caHoc">
                                                            <option>1</option>
                                                            <option>2</option>
                                                            <option>3</option>
                                                            <option>4</option>
                                                            <option>5</option>
                                                            <option>6</option>
                                                        </select>
                                                    </label>
                                                    <span class="errorSub" hidden>Thời gian này đã bị trùng</span>
                                                </div>
                                                <div class="checkbox">
                                                    <label class="col-sm-3">
                                                        Thứ 6
                                                        <input class="cbNgayHoc" value="6"
                                                               type="checkbox"/>
                                                        <input name="ngayHoc" class="ngayHocHid"
                                                               type="text" hidden/>
                                                    </label>
                                                    <label class="col-sm-3">
                                                        Ca
                                                        <select class="caHoc"
                                                                style="background-color: #DCDCDC"
                                                                disabled  name="caHoc">
                                                            <option>1</option>
                                                            <option>2</option>
                                                            <option>3</option>
                                                            <option>4</option>
                                                            <option>5</option>
                                                            <option>6</option>
                                                        </select>
                                                    </label>
                                                    <span class="errorSub" hidden>Thời gian này đã bị trùng</span>
                                                </div>
                                                <label class="col-sm-344">
                                                    Ca 1: 7h45 - 8h30 |
                                                    Ca 2: 8h30 - 9h15 |
                                                    Ca 3: 9h30 - 10h15 <br/>
                                                    Ca 4: 13h30 - 14h15 |
                                                    Ca 5: 14h15 - 15h00 |
                                                    Ca 6: 15h00 - 15h45 |

                                                </label>
                                            </div>


                                        </div>

                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="" class="col-sm-3 control-label">Mã lớp học <span class="red">(*)</span></label>
                                            <div class="col-md-9">
                                                <input id="maLop" readonly required name="maLop" type="text"
                                                       class="form-control"
                                                       placeholder="Mã lớp học">
                                            </div>
                                            <p class="col-sm-offset-3 help-block red">Example block-level help text
                                                here.</p>
                                        </div>
                                        <div class="form-group">
                                            <label for="" class="col-sm-3 control-label">Phòng học <span
                                                    class="red">(*)</span></label>
                                            <div class="col-md-9">
                                                <input id="phongHoc" readonly required name="phongHoc" type="text"
                                                       class="form-control"
                                                       placeholder="Phòng học">
                                            </div>
                                            <p class="col-sm-offset-3 help-block red">Example block-level help text
                                                here.</p>
                                        </div>
                                        <div class="form-group">
                                            <label for="" class="col-sm-3 control-label">Mô tả</label>
                                            <div class="col-md-9">
                                                <textarea required name="moTa" class="form-control" placeholder="Mô tả"
                                                          rows="2"></textarea>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="" class="col-sm-3 control-label">Ngày bắt đầu</label>
                                            <div class="col-md-9">
                                                <input id="ngayBatDau" type="date" required name="ngayBatDau"
                                                       class="form-control"
                                                       placeholder="Ngày bắt đầu">
                                            </div>
                                            <p class="col-sm-offset-3 help-block red">Example block-level help text
                                                here.</p>
                                        </div>
                                        <div class="form-group">
                                            <label for="" class="col-sm-3 control-label">Ngày kết thúc</label>
                                            <div class="col-md-9">
                                                <input type="date" required name="ngayKetThuc" class="form-control"
                                                       placeholder="Ngày kết thúc"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </form>
                    </div>
                    <div class="modal-footer text-center">
                        <button type="button" id="btn-themmoi" class="btn btn-primary"><i class="fa fa-plus-circle"
                                                                                          aria-hidden="true"></i> Thêm
                            mới
                        </button>
                        <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-sign-out"
                                                                                              aria-hidden="true"></i>
                            Thoát
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal xemnhansu -->
        <div class="modal modal-full fade" id="xemnhansu" role="dialog" aria-labelledby="xemnhansuLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h3 class="modal-title" id="xemnhansuLabel">
                            Thông tin lớp học
                        </h3>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal">
                            <div class="row bg-xam">
                                <div class="text-center avantar">

                                    <div class="col-md-4 p-25">
                                        <div class="form-group chamcham">
                                            <label for="">Mã lớp</label>
                                            <p id="malopDtl"></p>
                                        </div>
                                        <div class="form-group chamcham">
                                            <label for="">Giảng viên</label>
                                            <span id="giaoVienDtl"></span>
                                        </div>
                                        <div class="form-group chamcham">
                                            <label for="">Môn học</label>
                                            <span id="monHocDtl"></span>
                                        </div>

                                        <div class="form-group chamcham">
                                            <label for="">Phòng học</label>
                                            <span id="phongHocDtl"></span>
                                        </div>

                                        <div class="form-group chamcham">
                                            <label for="">Số lượng sinh viên</label>
                                            <span id="totalSvDtl"></span>
                                        </div>


                                    </div>
                                    <div class="col-md-5 inline-block p-25">

                                        <div class="form-group chamcham">
                                            <label for="">Mô tả</label>
                                            <span id="moTaDtl"></span>
                                        </div>

                                        <div class="form-group chamcham">
                                            <label for="">Ngày tạo lớp</label>
                                            <span id="ngayTaoDtl"></span>
                                        </div>

                                        <div class="form-group chamcham">
                                            <label for="">Ngày bắt đầu</label>
                                            <span id="ngayBDDTL"></span>
                                        </div>

                                        <div class="form-group chamcham">
                                            <label for="">Ngày kết thúc</label>
                                            <span id="ngayKTDtl"></span>
                                        </div>

                                    </div>
                                </div>

                            </div>
                            <div class="row gach-top">
                                <div class="col-md-8">
                                    <h4 class="title-sup-modal">
                <span>
                    Danh sách sinh viên
                </span>
                                    </h4>
                                    <div class="table">
                                        <table id="dsSinhVien">
                                            <thead class="fix-w text-center">
                                            <tr>
                                                <th>
                                                    STT
                                                </th>
                                                <th>
                                                    Mã sinh viên
                                                </th>
                                                <th class="uutien">
                                                    Họ và tên
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody>


                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <h4 class="title-sup-modal"><span>Lịch học:</span></h4>
                                    <div class="table tree-dot">
                                        <table id="lichHoc" class="tree-table">
                                            <thead>

                                            </thead>
                                            <tbody>
                                            <tr>

                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="modal-footer text-center">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-sign-out"
                                                                                              aria-hidden="true"></i>
                            Thoát
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!--test-->
    </div>

    <div th:replace="fragments/footer :: footer">&nbsp;</div>
</div>
</body>
<script th:inline="javascript">
    $('input:checkbox').on('change', function () {
        var numberOfChecked = $('input:checkbox:checked').length;
        if (numberOfChecked > parseInt(tinChi)) {
            this.checked = false;
        } else {
            var cbNgayHoc = $('.cbNgayHoc');
            var caHoc = $('.caHoc');
            var dayHid = $('.ngayHocHid');
            var ngayHoc = $(cbNgayHoc[cbNgayHoc.index(this)]).val();
            var stt = $(cbNgayHoc).index(this);

            if ($(this).is(":checked")) {
                $(caHoc[cbNgayHoc.index(this)]).prop('disabled', false);
                $(caHoc[cbNgayHoc.index(this)]).css("background-color", "");
                $(dayHid[cbNgayHoc.index(this)]).val(ngayHoc);
                var caHoc = $(caHoc[cbNgayHoc.index(this)]).val();
                var maGiaoVien = $('#giangVien').val();
                var kiHoc = $('#kiHoc').val();
                checkTimeExits(ngayHoc, caHoc, maGiaoVien, kiHoc, stt);

            } else {
                $(caHoc[cbNgayHoc.index(this)]).prop('disabled', 'disabled');
                $(caHoc[cbNgayHoc.index(this)]).css("background-color", "#DCDCDC");
                $(dayHid).val('');
                checkTimeExits(0, 0, maGiaoVien, 0, stt);
            }
        }

    });


    $('#khoaVien').change(function () {
        var maKhoaVien = $(this).val();
        $.ajax({
            url: base_url + 'lophoc/getValueForBoMon',
            type: "get",
            data: {khoaVien: maKhoaVien},
            dataType: "text",
            success: function (result) {
                $('#boMon').empty();
                var rs = JSON.parse(result);
                $.each(rs, function (i, obj) {
                    $('#boMon').append("<option value='" + obj.maNganh + "'>" + obj.tenNganh + "</option>");
                });
                var kiHoc = $('#kiHoc').val();
                var maBoMon = $('#boMon').val();
                getValueForMonHocAndGiangVien(kiHoc, maBoMon);
            }
        });
    });

    $('#boMon, #kiHoc').change(function () {
        var kiHoc = $('#kiHoc').val();
        var maBoMon = $('#boMon').val();
        getValueForMonHocAndGiangVien(kiHoc, maBoMon);
    });

    function getValueForMonHocAndGiangVien(kiHoc, maBoMon) {
        $.ajax({
            url: base_url + 'lophoc/getValueForMonHocAndGiangVien',
            type: "get",
            data: {kiHoc: kiHoc, boMon: maBoMon},
            dataType: "text",
            success: function (result) {
                $('#monHoc').empty();
                $('#giangVien').empty();
                var rs = JSON.parse(result);
                console.log(rs);
                $.each(rs[0], function (i, obj) {
                    $('#monHoc').append("<option value='" + obj.maMonHoc + "' tinchi='" + obj.tinChi + "'>" + obj.tenMonHoc + "</option>");
                });
                $.each(rs[1], function (i, obj) {
                    $('#giangVien').append("<option value='" + obj.maGiaoVien + "'>" + obj.user.fullName + "</option>");
                });
                getCode();

            }
        });
    }

    $('#btn-themmoi').click(function () {
        var valid = $("#form-themmoi").parsley();
        valid.validate();
        if (valid.isValid()) {
            var check = true;
            for (i = 0; i < allowSubmit.length; i++) {
                if (allowSubmit[i] == false)
                    check = false;
            }

            if (check) {
                var data = $('#form-themmoi').serialize();
                $.ajax({
                    url: base_url + 'lophoc/them-moi',
                    type: "post",
                    data: data,
                    dataType: "text",
                    success: function (result) {
                        $('#themnhansu').modal('hide');
                        sendMessage();
                        notify_sucess("Thêm lớp học", 'Thêm mới');
                    }, error: function (msg) {
                        notify_error("Thêm lớp học", 'Thêm mới');
                    }
                });
            }
        }
    });

    var allowSubmit = [true, true, true, true, true];


    $('.caHoc').on("change", function () {
        // var day = '#day' + value;
        // var ca = '#ca' + value;
        // var dayHid = '#day'+value+'Hid';
        var day = $('.cbNgayHoc');
        var ca = $('.caHoc');

        var ngayHoc = $(day[ca.index(this)]).val();
        var stt = $(ca).index(this);
        var caHoc = $(ca[ca.index(this)]).val();
        var maGiaoVien = $('#giangVien').val();
        var kiHoc = $('#kiHoc').val();
        checkTimeExits(ngayHoc, caHoc, maGiaoVien, kiHoc, stt);
    });

    function checkTimeExits(ngayHoc, caHoc, maGiaoVien, kiHoc, value) {
        var error = $('.errorSub');
        $.ajax({
            url: base_url + 'lophoc/checkTimeExits',
            type: "get",
            data: {ngayHoc: ngayHoc, caHoc: caHoc, maGiaoVien: maGiaoVien, kiHoc: kiHoc},
            dataType: "text",
            success: function (result) {
                var rs = JSON.parse(result);
                alert(rs);
                allowSubmit[value] = !rs;
                alert(allowSubmit);
                if (rs == 1) $(error[value]).show();
                else $(error[value]).hide();
            },
            error: function () {
                alert("lỗi server");
            }
        });
        getAvailableClass();
    }

    function getAvailableClass() {
        var caHoc = [];
        var ngayHoc = [];
        $('input:checkbox:checked').each(function (idx, el) {
            ngayHoc.push($(this).val());
        });
        $.each($(".caHoc:enabled"), function (idx, el) {
            caHoc.push($(this).val());
        });

        $.ajax({
            url: base_url + 'lophoc/getAvailableClass',
            type: "get",
            data: {ngayHoc: ngayHoc, caHoc: caHoc},
            // dataType: "text",
            success: function (result) {
                $('#phongHoc').val(result);
            },
            error: function () {
                alert("500 error");
            }
        });
    }

    $('#monHoc').change(function () {
        getCode();
    });

    function getCode() {
        var maMonHoc = $('#monHoc').val();
        tinChi = $('option:selected', '#monHoc').attr('tinchi');
        // alert(tinChi);
        if (maMonHoc != null) {
            $('#maLop').val(maMonHoc + "-" + [[${time}]]);
        }
    }


    $('.lh-detail').click(function () {
        if (checkView == 0) {
            var itemId = $(this).attr("itemId");
            $.ajax({
                url: base_url + 'lophoc/timkiem/' + itemId,
                type: "get",
                data: {id: itemId},
                dataType: "text",
                success: function (result) {
                    var rs = JSON.parse(result);
                    ;
                    $('#malopDtl').text(rs.maLop);
                    $('#giaoVienDtl').text(rs.giaoVien.user.fullName);
                    $('#monHocDtl').text(rs.monHoc.tenMonHoc);
                    $('#phongHocDtl').text(rs.phongHoc);
                    $('#totalSvDtl').text(rs.sinhViens.length);
                    $('#moTaDtl').text(rs.moTa);
                    $('#ngayTaoDtl').text(moment(rs.ngayTao).format("MMM Do YY"));
                    $('#ngayBDDTL').text(moment(rs.ngayBatDau).format("MMM Do YY"));
                    $('#ngayKTDtl').text(moment(rs.ngayKetThuc).format("MMM Do YY"));

                    $.each(rs.sinhViens, function (i, obj) {
                        $('#dsSinhVien tr:last')
                            .after("<tr>" +
                                "<td>" + (i + 1) + "</td>" +
                                "<td>" + obj.maSinhVien + "</td>" +
                                "<td>" + obj.user.fullName + "</td>" +
                                "</tr>");
                    });

                    var ngayHoc = rs.ngayHoc.split(',');
                    var caHoc = rs.caHoc.split(',');

                    for (i = 0; i < ngayHoc.length - 1; i++) {
                        console.log(ngayHoc[i]);
                        console.log(caHoc[i]);
                        $('#lichHoc tr:last')
                            .after("<tr><td style='width: 70px'>Thứ " + ngayHoc[i] + ":</td>" +
                                "<td>Ca " + caHoc[i] + "</td>" +
                                "</tr>");
                    }
                    checkView++;
                }
            });
        }
    });

    var checkView = 0;
    var tinChi = 0;
    var base_url = [[@{/}]];
    //
</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>


<script>
    var stompClient = null;

    var socket = new SockJS('http://localhost:8080/web/ws');
    stompClient = Stomp.over(socket);
    stompClient.connect({}, onConnected);

    function onConnected() {
        stompClient.subscribe('/topic/public', onMessageReceived);
        stompClient.send("/app/chat.addUser",
            {},
            JSON.stringify({sender: username, type: 'JOIN'})
        )
    }

    function onMessageReceived(payload) {
        var message = JSON.parse(payload.body);
    }

    function sendMessage() {
        var gv = document.getElementById("giangVien").value;
        var ml = document.getElementById("maLop").value;
        var ph = document.getElementById("phongHoc").value;
        var nbd = document.getElementById("ngayBatDau").value;
        var kiHoc = $('#kiHoc').val();
        var currentdate = new Date();
        var datetime = currentdate.getFullYear() + "-"
            + (currentdate.getMonth() + 1) + "-"
            + currentdate.getDate() + " "
            + currentdate.getHours() + ":"
            + currentdate.getMinutes() + ":"
            + currentdate.getSeconds();
        var chatMessage = {
            sender: "Admin",
            title: "Lớp mới",
            ki: kiHoc,
            maLop: ml,
            receiver: gv,
            content: "Bạn có 1 lớp mới: " + ml + " - Tại phòng: " + ph + " - Ngày bắt đầu: " + nbd,
            time: datetime
        };
        stompClient.send("/app/chat.sendMessage", {}, JSON.stringify(chatMessage));
    }
</script>


</html>
